<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.project.watnet.board.BoardMapper">
 	
 	<insert id="insBoard" useGeneratedKeys="true" keyProperty="boardPk">
 		INSERT INTO t_board
 		(category, title, shareId, sharePw, leaderpNum, startDt, endDt, price, ctnt)
 		VALUES
 		(#{category}, #{title}, #{shareId}, #{sharePw}, #{leaderpNum}, #{startDt}, #{endDt}, #{price}, #{ctnt})
 	</insert>
 	
 	<insert id="insParty">
 		INSERT INTO t_partyuser
 		(boardPk, userPk)
 		VALUES
 		(#{boardPk}, #{userPk})
 	</insert>
 	
 	<select id="selBoardList" resultType="BoardEntity">
 		SELECT * FROM t_board
 		WHERE category = #{category}
 		AND recruitNum <![CDATA[ < ]]> 4 
 		AND isDel = 0
 		ORDER BY startDt
 		LIMIT #{sIdx}, #{rowCnt}
 	</select>
 	
 	<select id="selMaxPageNum" resultType="int">
 		SELECT CEIL(COUNT(boardPk) / #{rowCnt})
		FROM t_board
		WHERE category = #{category}
		AND isDel = 0
 	</select>
 	
 	<select id="selParty" resultType="PartyUserEntity">
 		SELECT * FROM t_partyuser
 		<choose>
 			<when test="boardPk != null and boardPk != ''">
 				WHERE boardPk = #{boardPk}
 			</when>
 			<when test="userPk != null and userPk != ''">
 				WHERE userPk = #{userPk}
 			</when>
 		</choose>
 	</select>
 	
 	<select id="selBoard" resultType="BoardDomain">
 		SELECT A.*, B.nm
 		FROM t_board A
 		INNER JOIN t_board_manage B
 		ON A.category = B.category
 		WHERE A.boardPk = #{boardPk}
 	</select>
 	
 	<select id="selUserProfile" resultType="UserEntity">
 		SELECT A.*, B.userPk, B.nickname, B.profileImg
 		FROM t_partyuser A
 		INNER JOIN t_user B
 		ON A.userPk = B.userPk
 		WHERE A.boardPk = #{boardPk}
 		
 	</select>
 	
 	<update id="updBoard">
 		UPDATE t_board
 		SET recruitNum = recruitNum + 1
 		WHERE boardPk = #{boardPk}
 	</update>
 	
 </mapper>